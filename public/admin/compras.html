<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Registrar compra</title>
<style>
    body { background-color: #0f0f0f; color: #d8c7a3; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 30px; text-align: center; }
    h2 { font-size: 32px; margin-bottom: 20px; }
    h3 { color: #d8c7a3; margin-top: 20px; }
    input, select {
        background-color: #1c1c1c; color: #d8c7a3; border: 1px solid #d8c7a3;
        border-radius: 10px; padding: 8px; margin: 6px; width: 250px;
    }
    button { background-color: #1c1c1c; color: #d8c7a3; border: 2px solid #d8c7a3;
        border-radius: 24px; padding: 10px 20px; margin: 10px; font-size: 16px;
        cursor: pointer; transition: all 0.3s ease; }
    button:hover { background-color: #2a2a2a; transform: scale(1.05); }
    .producto { border: 1px solid #d8c7a3; padding: 15px; margin: 15px auto; width: 70%; border-radius: 8px; background: #1c1c1c; }
    .variable-item { margin-bottom: 10px; }
</style>
</head>
<body>

<h2>Registrar compra</h2>

<form id="form-compras" enctype="multipart/form-data">
    <!-- üîπ T√≠tulo General -->
    <h3>T√≠tulo general:</h3>
    <input type="text" name="titulo_general" placeholder="Ej: Compra de guantes" required><br><br>

    <!-- üîπ Contenedor donde se agregar√°n productos -->
    <div id="productos-container">
        <div class="producto">
            <h3>Producto:</h3>
            <input type="text" name="producto[]" placeholder="Ej: Guante verde" required><br>
            Imagen principal del producto: <input type="file" name="imagen_producto_0" accept="image/*" required><br><br>

            <div class="variables-container">
                <div class="variable-item">
                    Variable: <input name="variables_0[]" placeholder="Ej: Talle M" required>
                    Cantidad: <input name="cantidades_0[]" type="number" required>
                    Imagen (opcional): <input type="file" name="imagen_variable_0[]" accept="image/*">
                </div>
            </div>
            <button type="button" onclick="agregarVariable(this)">[ + ] Agregar Variable</button>
        </div>
    </div>

    <button type="button" onclick="agregarProducto()">[ + ] Agregar Otro Producto</button><br><br>

    <!-- üîπ Resto de datos de la compra -->
    <h3>Costos y fechas:</h3>
    Precio total: <input name="precio_total" type="number" required>
    <select name="moneda_precio"><option value="ARS">ARS</option><option value="USD">USD</option></select><br>

    Env√≠o: <input name="envio" type="number">
    <select name="moneda_envio"><option value="ARS">ARS</option><option value="USD">USD</option></select><br>

    Costo extra: <input name="costo_extra" type="number">
    <select name="moneda_extra"><option value="ARS">ARS</option><option value="USD">USD</option></select><br>

    Aduana: <input name="aduana" type="number">
    <select name="moneda_aduana"><option value="ARS">ARS</option><option value="USD">USD</option></select><br>

    Cotizaci√≥n USD: <input name="cotizacion" type="number"><br>
    Fecha compra: <input name="fecha_compra" type="date"><br>
    Fecha llegada: <input name="fecha_llegada" type="date"><br>

    <button type="submit">Guardar compra</button>
</form>

<script>
let productoIndex = 1;

function agregarProducto() {
    const container = document.getElementById('productos-container');
    const div = document.createElement('div');
    div.classList.add('producto');
    div.innerHTML = `
        <h3>Producto:</h3>
        <input type="text" name="producto[]" placeholder="Ej: Guante azul" required><br>
        Imagen principal del producto: <input type="file" name="imagen_producto_${productoIndex}" accept="image/*" required><br><br>

        <div class="variables-container">
            <div class="variable-item">
                Variable: <input name="variables_${productoIndex}[]" placeholder="Ej: Color Azul" required>
                Cantidad: <input name="cantidades_${productoIndex}[]" type="number" required>
                Imagen (opcional): <input type="file" name="imagen_variable_${productoIndex}[]" accept="image/*">
            </div>
        </div>
        <button type="button" onclick="agregarVariable(this)">[ + ] Agregar Variable</button>
    `;
    container.appendChild(div);
    productoIndex++;
}

function agregarVariable(btn) {
    const variablesContainer = btn.parentNode.querySelector('.variables-container');
    const pIndex = Array.from(document.getElementById('productos-container').children).indexOf(btn.parentNode);
    const div = document.createElement('div');
    div.classList.add('variable-item');
    div.innerHTML = `
        Variable: <input name="variables_${pIndex}[]" placeholder="Ej: Otro talle o color" required>
        Cantidad: <input name="cantidades_${pIndex}[]" type="number" required>
        Imagen (opcional): <input type="file" name="imagen_variable_${pIndex}[]" accept="image/*">
    `;
    variablesContainer.appendChild(div);
}

document.getElementById('form-compras').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);

    const resp = await fetch('/api/compras', {
        method: 'POST',
        body: formData
    });

    const data = await resp.json();
    alert(data.mensaje || 'Compra registrada');
    e.target.reset();
});
</script>

</body>
</html>
